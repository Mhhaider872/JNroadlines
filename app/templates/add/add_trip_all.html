<!-- @format -->
{% include 'base.html' %}
{% load static %}


  <body>
    <main id="main" class="main">
      <div class="pagetitle">
        <h1>Add Trip</h1>
        <nav>
          <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
            <li class="breadcrumb-item active">Dashboard</li>
          </ol>
        </nav>
      </div>
      <!-- End Page Title -->
      {% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-info {{ message.tags }} alert-dismissible fade show" role="alert">
       <h5 class="text-center"> {{ message }}</h5>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}
      <section class="section">
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body py-4">
                {% comment %} <a href="{% url 'aak-local' %}" class="btn btn-primary  float-end">AAK India Local</a> {% endcomment %}
                <div class="col-lg-3 float-end">
    <div class="card-body py-3">
        <label for="company-select" class="form-label fw-bold">Select Company</label>
        <select class="form-select" id="company-select" aria-label="Default select example">
        <option value="#" selected>Select Company </option>
            <option value="{% url 'aak-local' %}">AAK India Local</option>
            <option value="{% url 'trip-gemini' %}">Gemini Edibles</option>

           
             <option value="{% url 'trip-adani' %}">Adani wilmar Ltd</option>
             
        </select>
    </div>
</div>
                </div>
    <section class="main-sec">

  <div class="container">
    <div class="row">
      <div class="col-lg-12 form-div">
        <form  method="POST">
        {% csrf_token %}
          <div class="row">
            {% comment %} <div class="col-lg-4 mb-3">
              <select id="tankerno" name="tankerno">
             <option value="">-- Select Tanker --</option>
              {% for plan in plans %}
              <option value="{{ plan.id }}">{{ plan.tankerno }}</option>
              {% endfor %}
              </select>
            
            </div>


            <div class="col-lg-4 mb-3">
            <label for="fadd" class="form-label fw-bold">From Address</label>
            <input type="text" id="From_address" name="From_address" readonly>
              
            </div>
            <div class="col-lg-4 mb-3">
              <label for="toadd" class="form-label fw-bold">To Address</label>
              <input type="text" id="To_address" name="To_address" readonly>
            </div>
             <div class="col-lg-4 mb-3">
             <label for="driver" class="form-label fw-bold">Driver Name</label>
             <input type="text" id="drivername" name="drivername" readonly>
            </div>
          <div class="col-lg-4 mb-3">
           <label for="tanker" class="form-label fw-bold">Tanker Capacity</label>
            <input type="text" id="tanker_capacity" name="tanker_capacity" readonly>
          </div>
          <div class="col-lg-4 mb-3">
           <label for="tdate" class="form-label fw-bold">Trip Date</label>

            <input type="text" id="dispatch_Date" name="dispatch_Date" readonly>
           
          </div> {% endcomment %}
          <div class="col-lg-4 mb-3">
            <label for="label4" class="form-label fw-bold"
              >Arrival at Loading Point (Plant) Date & Time</label
            >
            <input
              type="datetime-local"
              name="arrival_time"
              class="form-control"
              id="label4"
            />
          </div>
          <div class="col-lg-4 mb-3">
            <label for="label5" class="form-label fw-bold"
              >Dispatched date & time</label
            >
            <input
              type="datetime-local"
              name="dispatch_time"
              class="form-control"
              id="label5"
            />
          </div>
         

          {% comment %} <div class="col-lg-4 mb-3">
            <label for="label5" class="form-label fw-bold"
              >Vehicle Kilometer when the vehicle returned at AAK India, Khopoli plant after unloading at Consignee plant  (As per Ganesh Sir </label
            >
            <input
              type="number"
              class="form-control"
              name="dispddate"
              min="0"
              id="label5"
            />
          </div> {% endcomment %}
          {% comment %} <div class="col-lg-4 mb-3">
            <label for="label6" class="form-label fw-bold"
              >Vehicle Kilometer at the time of Loading at AAK India, Khopoli plant (As per Ashok Mama )
            </label>
            <input
              type="text"
              class="form-control"
              name="tankcap"
              min="0"
              id="label6"
            />
          </div> {% endcomment %}
          {% comment %} <div class="col-lg-4 mb-3">
            <label for="label7" class="form-label fw-bold">Vehicle Kilometer when the vehicle returned at AAK India, Khopoli plant after unloading at Consignee plant  (As per Ganesh Sir )</label>
           <input type="number" class="form-control " >
          </div> {% endcomment %}
           <div class="col-lg-4 mb-3">
            <label for="label5" class="form-label fw-bold"
              >Reached date & time</label
            >
            <input
              type="datetime-local"
              name="reach_time"
              class="form-control"
              id="label5"
            />
          </div>
{% comment %} 
          <div class="col-lg-4 mb-3">
            <label for="label8" class="form-label fw-bold">Vehicle Kilometer when the vehicle returned at AAK India, Khopoli plant after unloading at Consignee plant  (As per Ashok mama )</label>
            <input
              type="text"
              class="form-control"
              name="product"
              min="0"
              id="label8"
            />
          </div> {% endcomment %}
          {% comment %} <div class="col-lg-4 mb-3">
            <label for="label5" class="form-label fw-bold"
              >Vehicle Date & Time when the vehicle returned at AAK India, Khopoli plant after unloading at Consignee plant  </label
            >
            <input
              type="datetime-local"
              name="ardate"
              class="form-control"
              id="label5"
            />
          </div> {% endcomment %}
          {% comment %} <div class="col-lg-4 mb-3">
            <label for="label9" class="form-label fw-bold">Vehicle Kilometer Per Trip (As per Ganesh Sir)  </label>
            <input
              type="number"
              class="form-control"
              name="traday"
              min="0"
              id="label9"
            />
          </div> {% endcomment %}

        {% comment %} <div class="col-lg-4 mb-3">
            <label for="label9" class="form-label fw-bold">Vehicle Kilometer Per Trip (As per Ashok Mama )  </label>
            <input
              type="number"
              class="form-control"
              name="traday"
              min="0"
              id="label9"
            />
          </div> {% endcomment %}
        
          <div class="col-lg-4 mb-3">
            <label for="label12" class="form-label fw-bold"
              >Unloading date & time</label
            >
            <input
              type="datetime-local"
              name="unload_time"
              class="form-control shadow-sm border-0"
              id="label12"
            />
        </div>
        
        <div class="col-lg-4 mb-3">
            <label for="label17" class="form-label fw-bold">LR No</label>
            <input
              type="number"
              class="form-control"
              name="lr_num"
              min="0"
              id="label17"
            />
        </div>
        <div class="col-lg-4 mb-3">
            <label for="label18" class="form-label fw-bold"
              >LR Received Date</label
            >
            <input
              type="date"
              name="lr_date"
              class="form-control"
              id="label18"
            />
        </div>
         <div class="col-lg-4 mb-3">
            <label for="label19" class="form-label fw-bold"
              >Freight Bill no.</label
            >
            <input
              type="number"
              name="freight_bill"
              class="form-control"
              id="label19"
               min="0"
            />
        </div>
        <div class="col-lg-4 mb-3">
            <label for="label20" class="form-label fw-bold"
              >Freight Bill Date</label
            >
            <input
              type="date"
              class="form-control"
              name="freight_date"
              id="label20"
            />
        </div>
        <div class="col-lg-4 mb-3">
            <label for="label13" class="form-label fw-bold">Loaded Qty</label>
            <input type="number" class="form-control" id="disqty" name="loaded_qty" value="{{t.totalshort}}" oninput="calculateTotalShort()">
        </div>
     <div class="col-lg-4 mb-3">
            <label for="label13" class="form-label fw-bold">Allow Percentage</label>
            <input type="number" class="form-control" id="shortallow" name="percent" value="{{t.totalshort}}" oninput="calculateTotalShort()" step="0.01">
        </div> 
          <div class="col-lg-4 mb-3">
            <label for="label13" class="form-label fw-bold">Unloaded Qty</label>
            <input type="number" class="form-control" id="unlodqty" name="unload_qty" value="{{t.totalshort}}" oninput="calculateTotalShort()">
        </div>
        <div class="col-lg-4 mb-3">
            <label for="label14" class="form-label fw-bold"
              >Total Shortages Qty</label
            >
            <input type="number" class="form-control" id="totalshort" name="short_qty" readonly>
        </div>
        <div class="col-lg-4 mb-3">
            <label for="label15" class="form-label fw-bold"
              >Shortages allowed against loaded Qty</label
            >
            <input
              type="number"
              class="form-control"
              name="short_allow"
              min="0"
              id="loadedQtyPercent" name="loadedQtyPercent" oninput="calculateTotalShort()" readonly
            />
        </div>
        <div class="col-lg-4 mb-3">
            <label for="label16" class="form-label fw-bold">Return Qty</label>
            <input
              type="number"
              class="form-control"
              name="return_qty"
              min="0"
              id="label16"
            />
        </div>
         
         
          
        <div class="col-lg-4 mb-3">
            <label for="label21" class="form-label fw-bold"
              >J. N. Roadlines Remarks</label
            >
            <input
              type="text"
              class="form-control"
              name="remark"
              min="0"
              id="label21"
            />
        </div>
        <div class="btn-div text-center py-2">
            <button type="submit" class="btn btn-success px-4 mx-2">Add</button>
            <a href="{% url 'showtrip' %}" class="btn btn-info px-4">View</a>
        </div>
        </form>
      </div>
    </div>
  </div>
</section>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <!-- End #main -->

    <!-- ======= Footer ======= -->
    <footer id="footer" class="footer">
      <div class="copyright">
        &copy; Copyright <strong>. All Rights Reserved</strong>
      </div>
      <div class="credits">
        Designed by <a href="#"><strong>J N Roadlines</strong></a>
      </div>
    </footer>
    <!-- End Footer -->

    <a
      href="#"
      class="back-to-top d-flex align-items-center justify-content-center"
      ><i class="bi bi-arrow-up-short"></i
    ></a>
 {% comment %} <script>
        function calculateTotalShort() {
            // Get the values of disqty and unlodqty from the form
            var disqty = document.getElementById("disqty").value;
            var unlodqty = document.getElementById("unlodqty").value;


            // Calculate totalshort only if both values are numbers
            if (disqty && unlodqty) {
                var totalshort = parseInt(disqty) - parseInt(unlodqty);
                document.getElementById("totalshort").value = totalshort; // Display totalshort in the input field
            }
        }
    </script> {% endcomment %}
<script>
    function calculateTotalShort() {
        // Get the values of disqty, unlodqty, and shortallow
        var disqty = document.getElementById("disqty").value;
        var unlodqty = document.getElementById("unlodqty").value;
        var shortallow = document.getElementById("shortallow").value;

        // Ensure values are numbers and disqty and unlodqty are available
        if (disqty && unlodqty) {
            // Calculate totalshort and update it
            var totalshort = parseInt(disqty) - parseInt(unlodqty);
            document.getElementById("totalshort").value = totalshort; // Display totalshort in the input field
        }

        // Ensure the Allow Percentage (shortallow) and Loaded Qty (disqty) are valid numbers
        if (shortallow && disqty) {
            // Calculate and update the shortages allowed (as percentage of loaded qty)
            var loadedQtyPercent = (parseFloat(disqty) * parseFloat(shortallow)) / 100;
            //var result = parseInt(loadedQtyPercent * 100);
            document.getElementById("loadedQtyPercent").value = loadedQtyPercent.toFixed(2); // Round to 2 decimal places 
            //var result = parseInt(loadedQtyPercent * 100);
            //document.getElementById("loadedQtyPercent").value = result;
        }
    }
</script>


{% comment %} <script>
  function calculateTotalShort() {
      // Get the values of disqty and unlodqty from the form
      var disqty = document.getElementById("disqty").value;
      var unlodqty = document.getElementById("unlodqty").value;

      // Ensure that disqty and unlodqty have values and are numbers
      if (disqty && unlodqty) {
          // Calculate totalshort (disqty - unlodqty)
          var totalshort = parseInt(disqty) - parseInt(unlodqty);

          // Update the totalshort input field
          document.getElementById("totalshort").value = totalshort;

          // Subtract 50 from totalshort and update the shortallow field
          var shortallow = totalshort - 50;

          // Set the result in the shortallow field
          document.getElementById("shortallow").value = shortallow;

          // Check if totalshort is 0
          if (totalshort === 0) {
              // Optionally, disable fields or set default values if needed
              document.getElementById("shortallow").value = 0;  // Reset shortallow
           
          }
      }
  }
</script> {% endcomment %}

<script>
    document.getElementById('company-select').addEventListener('change', function() {
        var selectedUrl = this.value;  // Get the selected URL
        window.location.href = selectedUrl;  // Redirect to the selected URL
    });
</script>
<script>
document.getElementById("tankerno").addEventListener("change", function() {
    let planId = this.value;

    if (planId) {
        fetch(`/get_plan_details/?plan_id=${planId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById("drivername").value = data.drivername || '';
                document.getElementById("From_address").value = data.From_address || '';
                document.getElementById("To_address").value = data.To_address || '';
                document.getElementById("tanker_capacity").value = data.tanker_capacity || '';
                document.getElementById("dispatch_Date").value = data.dispatch_Date || '';
            });
    } else {
        document.getElementById("drivername").value = '';
        document.getElementById("From_address").value = '';
        document.getElementById("To_address").value = '';
        document.getElementById("tanker_capacity").value = '';
        document.getElementById("dispatch_Date").value = '';
    }
});
</script>
  </body>

